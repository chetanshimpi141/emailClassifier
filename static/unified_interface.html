<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Spam Classifier - ML vs LLM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .model-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .model-option {
            padding: 15px 30px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            font-weight: 500;
        }

        .model-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .model-option.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            margin-top: 40px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .result-card.ml {
            border-color: #28a745;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }

        .result-card.llm {
            border-color: #007bff;
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        }

        .result-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .result-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
        }

        .result-icon.ml {
            background: #28a745;
            color: white;
        }

        .result-icon.llm {
            background: #007bff;
            color: white;
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .prediction {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
        }

        .prediction.spam {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .prediction.ham {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .confidence {
            text-align: center;
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
        }

        .details {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .details h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .details ul {
            list-style: none;
            padding: 0;
        }

        .details li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .details li:last-child {
            border-bottom: none;
        }

        .comparison {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            text-align: center;
        }

        .comparison h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .comparison-result {
            font-size: 1.2rem;
            font-weight: 600;
            color: #856404;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .status-indicator {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-item.online {
            background: #d4edda;
            color: #155724;
        }

        .status-item.offline {
            background: #f8d7da;
            color: #721c24;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.online {
            background: #28a745;
        }

        .status-dot.offline {
            background: #dc3545;
        }

        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .model-selector {
                flex-direction: column;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 Email Spam Classifier</h1>
            <p>Compare ML vs LLM Predictions</p>
        </div>

        <div class="main-content">
            <!-- Model Selector -->
            <div class="model-selector">
                <div class="model-option active" data-model="both">
                    <span>🔄 Both Models</span>
                </div>
                <div class="model-option" data-model="ml">
                    <span>🤖 ML Model</span>
                </div>
                <div class="model-option" data-model="llm">
                    <span>🧠 LLM Model</span>
                </div>
            </div>

            <!-- Status Indicators -->
            <div class="status-indicator">
                <div class="status-item" id="ml-status">
                    <div class="status-dot"></div>
                    <span>ML Model</span>
                </div>
                <div class="status-item" id="llm-status">
                    <div class="status-dot"></div>
                    <span>LLM Model</span>
                </div>
            </div>

            <!-- Input Section -->
            <div class="input-section">
                <div class="input-group">
                    <label for="email-text">📧 Email Content:</label>
                    <textarea 
                        id="email-text" 
                        placeholder="Enter email content here...&#10;&#10;Example:&#10;Subject: URGENT: You've won $1,000,000!&#10;&#10;CONGRATULATIONS! You are the lucky winner of our sweepstakes! Click here to claim your prize now!"
                    ></textarea>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" id="predict-btn" onclick="predictEmail()">
                        🔮 Predict
                    </button>
                    <button class="btn btn-secondary" onclick="clearResults()">
                        🗑️ Clear
                    </button>
                </div>
            </div>

            <!-- Loading Section -->
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Analyzing email with selected models...</p>
            </div>

            <!-- Results Section -->
            <div id="results" class="results-section" style="display: none;">
                <div class="results-grid" id="results-grid">
                    <!-- Results will be populated here -->
                </div>

                <div id="comparison" class="comparison" style="display: none;">
                    <h3>📊 Model Comparison</h3>
                    <div class="comparison-result" id="comparison-result"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        const LLM_API_BASE = 'http://localhost:8001';
        let selectedModel = 'both';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkModelStatus();
            setupModelSelector();
        });

        function setupModelSelector() {
            const options = document.querySelectorAll('.model-option');
            options.forEach(option => {
                option.addEventListener('click', function() {
                    options.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    selectedModel = this.dataset.model;
                });
            });
        }

        async function checkModelStatus() {
            // Check ML model status
            try {
                const mlResponse = await fetch(`${API_BASE}/health`);
                const mlData = await mlResponse.json();
                updateStatus('ml-status', mlData.model_loaded);
            } catch (error) {
                updateStatus('ml-status', false);
            }

            // Check LLM model status
            try {
                const llmResponse = await fetch(`${LLM_API_BASE}/health`);
                const llmData = await llmResponse.json();
                updateStatus('llm-status', llmData.classifier_loaded);
            } catch (error) {
                updateStatus('llm-status', false);
            }
        }

        function updateStatus(elementId, isOnline) {
            const element = document.getElementById(elementId);
            const dot = element.querySelector('.status-dot');
            const text = element.querySelector('span');
            
            if (isOnline) {
                element.className = 'status-item online';
                dot.className = 'status-dot online';
            } else {
                element.className = 'status-item offline';
                dot.className = 'status-dot offline';
            }
        }

        async function predictEmail() {
            const emailText = document.getElementById('email-text').value.trim();
            if (!emailText) {
                alert('Please enter email content');
                return;
            }

            showLoading();
            clearResults();

            try {
                const results = {};

                // Get ML prediction
                if (selectedModel === 'both' || selectedModel === 'ml') {
                    try {
                        const mlResult = await getMLPrediction(emailText);
                        results.ml = mlResult;
                    } catch (error) {
                        console.error('ML prediction failed:', error);
                        results.ml = { error: 'ML model not available' };
                    }
                }

                // Get LLM prediction
                if (selectedModel === 'both' || selectedModel === 'llm') {
                    try {
                        const llmResult = await getLLMPrediction(emailText);
                        results.llm = llmResult;
                    } catch (error) {
                        console.error('LLM prediction failed:', error);
                        results.llm = { error: 'LLM model not available' };
                    }
                }

                displayResults(results);
            } catch (error) {
                showError('Prediction failed: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function getMLPrediction(emailText) {
            const formData = new FormData();
            formData.append('email_text', emailText);
            
            const response = await fetch(`${API_BASE}/predict`, {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                throw new Error(`ML API error: ${response.status}`);
            }
            
            return await response.json();
        }

        async function getLLMPrediction(emailText) {
            const formData = new FormData();
            formData.append('email_text', emailText);
            
            const response = await fetch(`${LLM_API_BASE}/classify`, {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                throw new Error(`LLM API error: ${response.status}`);
            }
            
            return await response.json();
        }

        function displayResults(results) {
            const resultsGrid = document.getElementById('results-grid');
            resultsGrid.innerHTML = '';

            if (results.ml && !results.ml.error) {
                resultsGrid.appendChild(createResultCard('ml', results.ml));
            }

            if (results.llm && !results.llm.error) {
                resultsGrid.appendChild(createResultCard('llm', results.llm));
            }

            // Show comparison if both models are available
            if (results.ml && results.llm && !results.ml.error && !results.llm.error) {
                showComparison(results.ml, results.llm);
            }

            document.getElementById('results').style.display = 'block';
        }

        function createResultCard(modelType, result) {
            const card = document.createElement('div');
            card.className = `result-card ${modelType}`;

            const isSpam = result.prediction === 'spam' || result.classification === 'SPAM';
            const confidence = result.confidence || 0;

            card.innerHTML = `
                <div class="result-header">
                    <div class="result-icon ${modelType}">
                        ${modelType === 'ml' ? '🤖' : '🧠'}
                    </div>
                    <div class="result-title">
                        ${modelType === 'ml' ? 'Machine Learning' : 'Large Language Model'}
                    </div>
                </div>
                
                <div class="prediction ${isSpam ? 'spam' : 'ham'}">
                    ${isSpam ? '🚨 SPAM' : '✅ HAM'}
                </div>
                
                <div class="confidence">
                    Confidence: ${(confidence * 100).toFixed(1)}%
                </div>
                
                <div class="details">
                    <h4>Details:</h4>
                    <ul>
                        ${modelType === 'ml' ? 
                            `<li>Probability: ${(confidence * 100).toFixed(1)}%</li>` :
                            `<li>Reasons: ${result.reasons ? result.reasons.join(', ') : 'N/A'}</li>
                             <li>Explanation: ${result.explanation || 'N/A'}</li>`
                        }
                    </ul>
                </div>
            `;

            return card;
        }

        function showComparison(mlResult, llmResult) {
            const comparison = document.getElementById('comparison');
            const comparisonResult = document.getElementById('comparison-result');
            
            const mlIsSpam = mlResult.prediction === 'spam';
            const llmIsSpam = llmResult.classification === 'SPAM';
            const agreement = mlIsSpam === llmIsSpam;
            
            comparisonResult.textContent = agreement ? 
                '✅ Models Agree' : 
                '⚠️ Models Disagree';
            
            comparison.style.display = 'block';
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('predict-btn').disabled = true;
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('predict-btn').disabled = false;
        }

        function clearResults() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('comparison').style.display = 'none';
            document.getElementById('results-grid').innerHTML = '';
        }

        function showError(message) {
            const results = document.getElementById('results');
            results.innerHTML = `<div class="error">${message}</div>`;
            results.style.display = 'block';
        }
    </script>
</body>
</html> 